import dotenv from 'dotenv';
dotenv.config();

(BigInt.prototype as any).toJSON = function () {
  return this.toString();
};


import express from 'express';
import cors from 'cors';
import helmet from 'helmet';
import passport from 'passport';
import './src/config/passport.ts';
import authRoutes from './src/routes/authRoutes.ts';
import { authenticateJWT } from './src/middleware/auth.ts';
import metadataRoutes from './src/routes/metadataRoutes.ts';
import dashboardRoutes from './src/routes/dashboardRoutes.ts';
import heatmapRoutes from './src/routes/heatmapRoutes.ts';
import analyticsRoutes from './src/routes/analyticsRoutes.ts';
import alertsRoutes from './src/routes/alertsRoutes.ts';
import searchRoutes from './src/routes/searchRoutes.ts';
import policyRoutes from "./src/routes/policyRoutes.ts";

const app = express();
const PORT = 5000;

app.use(helmet());
app.use(cors());
app.use(express.json());
app.use(passport.initialize());

app.use('/auth', authRoutes);
app.use('/metadata', metadataRoutes);
app.use('/api/dashboard', dashboardRoutes);
app.use('/api/heatmap', heatmapRoutes);
app.use('/api/analytics', analyticsRoutes);
app.use('/api/alerts', alertsRoutes);
app.use('/api/search', searchRoutes);
app.use('/api/policy', policyRoutes);

app.get('/', (req, res) => {
  res.json({ message: 'ðŸš€ API is running!' });
});


app.get('/api/secure', authenticateJWT, (req, res) => {
  res.json({ message: 'This is a protected route', user: (req as any).user });
});


app.listen(PORT, () => {
  console.log(`âœ… Server running on http://localhost:${PORT}`);
});